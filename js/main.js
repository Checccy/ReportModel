        var Report={"IsCopyReportResult":false,"ReportRPatient":{"Id":62694,"PatientTypeCode":"0","PatientTypeName":null,"PatientCode":"534255","PatientName":"陆林涛","PatientSex":"1","PatientAge":"69","DoctorCode":"陈光建","DoctorName":null,"ReporterAccount":null,"CollectAccount":"","Diagnosis":"脑出血","BedNo":"8","DepartmentCode":"010208","DepartmentName":"SICU","InpatientAreaCode":"09102","InpatientAreaName":"同康二病区","ApplyDate":"2016-04-11 16:31:29","CollectDate":"2016-04-11 16:31:29","ReportDate":"2016-04-15 00:00:00","Remark":"深静脉尖端","SpecimenTypeCode":"24","SpecimenTypeName":"导管","ChargeTypeCode":"新医保","ChargeTypeName":"新医保","AgeUnit":"","SampleNoPrefix":"WX","Barcode":"1200308311","InspectItem":"250501009B,","InspectItemName":"一般细菌培养及鉴定(仪器法),"},"ReportRIdentifyResult":[{"Id":112136,"BacteriaCode":"XJ2113","BacteriaName":"肺炎克雷伯菌(泛耐药)","TestValue":"检出","TestValueDescription":null,"BacteriaSerial":1}],"ReportRAntibioticResult":[{"Id":69267,"AntibioticCode":"AM-V32","AntibioticName":"氨苄西林","TestValue":"耐药(R)","MIC":">=32","MID":null,"BacteriaSerial":1,"AntibioticType":1,"BreakPointRange":null},{"Id":69268,"AntibioticCode":"AMS-V32","AntibioticName":"氨苄西林舒巴坦","TestValue":"耐药(R)","MIC":">=32","MID":null,"BacteriaSerial":1,"AntibioticType":1,"BreakPointRange":null},{"Id":69269,"AntibioticCode":"TZP-V32","AntibioticName":"哌拉西林他唑巴坦","TestValue":"耐药(R)","MIC":">=128","MID":null,"BacteriaSerial":1,"AntibioticType":1,"BreakPointRange":null},{"Id":69270,"AntibioticCode":"CZ-V32","AntibioticName":"头孢唑啉","TestValue":"耐药(R)","MIC":">=64","MID":null,"BacteriaSerial":1,"AntibioticType":1,"BreakPointRange":null},{"Id":69271,"AntibioticCode":"CTE-V32","AntibioticName":"头孢替坦","TestValue":"耐药(R)","MIC":">=64","MID":null,"BacteriaSerial":1,"AntibioticType":1,"BreakPointRange":null},{"Id":69272,"AntibioticCode":"TAZ-V32","AntibioticName":"头孢他啶","TestValue":"耐药(R)","MIC":">=64","MID":null,"BacteriaSerial":1,"AntibioticType":1,"BreakPointRange":null},{"Id":69273,"AntibioticCode":"CTR-V32","AntibioticName":"头孢曲松","TestValue":"耐药(R)","MIC":">=64","MID":null,"BacteriaSerial":1,"AntibioticType":1,"BreakPointRange":null},{"Id":69274,"AntibioticCode":"FEP-V32","AntibioticName":"头孢吡肟","TestValue":"耐药(R)","MIC":">=64","MID":null,"BacteriaSerial":1,"AntibioticType":1,"BreakPointRange":null},{"Id":69275,"AntibioticCode":"AZM-V32","AntibioticName":"氨曲南","TestValue":"耐药(R)","MIC":">=64","MID":null,"BacteriaSerial":1,"AntibioticType":1,"BreakPointRange":null},{"Id":69276,"AntibioticCode":"IMI-V32","AntibioticName":"亚胺培南","TestValue":"耐药(R)","MIC":">=16","MID":null,"BacteriaSerial":1,"AntibioticType":1,"BreakPointRange":null},{"Id":69277,"AntibioticCode":"AN-V32","AntibioticName":"丁胺卡那霉素","TestValue":"耐药(R)","MIC":">=64","MID":null,"BacteriaSerial":1,"AntibioticType":1,"BreakPointRange":null},{"Id":69278,"AntibioticCode":"GM-V32","AntibioticName":"庆大霉素","TestValue":"耐药(R)","MIC":">=16","MID":null,"BacteriaSerial":1,"AntibioticType":1,"BreakPointRange":null},{"Id":69279,"AntibioticCode":"TOB-V32","AntibioticName":"妥布霉素","TestValue":"耐药(R)","MIC":">=16","MID":null,"BacteriaSerial":1,"AntibioticType":1,"BreakPointRange":null},{"Id":69280,"AntibioticCode":"CIP-V32","AntibioticName":"环丙沙星","TestValue":"耐药(R)","MIC":">=4","MID":null,"BacteriaSerial":1,"AntibioticType":1,"BreakPointRange":null},{"Id":69281,"AntibioticCode":"LEV-V32","AntibioticName":"左旋氧氟沙星","TestValue":"耐药(R)","MIC":">=8","MID":null,"BacteriaSerial":1,"AntibioticType":1,"BreakPointRange":null},{"Id":69282,"AntibioticCode":"SXT-V32","AntibioticName":"复方新诺明","TestValue":"耐药(R)","MIC":">=16","MID":null,"BacteriaSerial":1,"AntibioticType":1,"BreakPointRange":null},{"Id":69283,"AntibioticCode":"SCF","AntibioticName":"头孢哌酮/舒巴坦","TestValue":"耐药(R)","MIC":null,"MID":"6","BacteriaSerial":1,"AntibioticType":2,"BreakPointRange":"16-20"},{"Id":69284,"AntibioticCode":"MEM","AntibioticName":"美罗培南","TestValue":"耐药(R)","MIC":null,"MID":"6","BacteriaSerial":1,"AntibioticType":2,"BreakPointRange":"20-22"},{"Id":69285,"AntibioticCode":"TGC","AntibioticName":"替吉环素","TestValue":"敏感(S)","MIC":null,"MID":"17","BacteriaSerial":1,"AntibioticType":2,"BreakPointRange":"13-15"},{"Id":69286,"AntibioticCode":"CXM1","AntibioticName":"头孢呋辛口服","TestValue":"耐药(R)","MIC":null,"MID":"6","BacteriaSerial":1,"AntibioticType":2,"BreakPointRange":"15-22"},{"Id":69287,"AntibioticCode":"CXM2","AntibioticName":"头孢呋辛注射","TestValue":"耐药(R)","MIC":null,"MID":"6","BacteriaSerial":1,"AntibioticType":2,"BreakPointRange":"15-17"}],"Id":62852,"RecordId":69703,"SampleNo":"WX8000","ReportDate":"2016-04-15 00:00:00","ReportType":0}

        var PaperType={
            A3:{width:297,height:420,isDefault:false},
            A4:{width:210,height:297,isDefault:true},
            A5:{width:148,height:210,isDefault:false},
            A6:{width:105,height:148,isDefault:false},
            B4:{width:257,height:364,isDefault:false},
            B5:{width:182,height:257,isDefault:false},
            B6:{width:158,height:182,isDefault:false},
            Other:{width:100,height:100,isDefault:false}
        }
        var ControlLibrary={
                ReportControl:[
                    {code:'Hospital',text:'医院名称',example:'上海同济医院微生物报告',type:'title',category:'ReportInfo'},
                    {code:'PatientName',text:'病人姓名',example:'姓名：贾三',type:'default',category:'PatientInfo'},
                    {code:'PatientSex',text:'性别',example:'性别：女',type:'default',category:'PatientInfo'},
                    {code:'PatientAge',text:'年龄',example:'年龄：25',type:'default',category:'PatientInfo'},
                    {code:'RecordId',text:'记录单号',example:'记录单号：56959',type:'default',category:'ReportInfo'},
                    {code:'SampleNo',text:'样本号',example:'样本号：WS9002',type:'default',category:'PatientInfo'},
                    {code:'ReportDate',text:'报告时间',example:'报告时间：2016-03-02 00:00:00',type:'default',category:'ReportInfo'},
                    {code:'ApplyDate',text:'申请时间',example:'申请时间：2016-03-01 17:52:38',type:'default',category:'ReportInfo'},
                    {code:'CollectDate',text:'接收时间',example:'接收时间：2016-03-01 18:12:38',type:'default',category:'ReportInfo'},
                    {code:'ReviewName',text:'审核者',example:'审核者：候伟伟',type:'default',category:'ReportInfo'},
                    {code:'DoctorName',text:'检验者',example:'检验者：江链',type:'default',category:'ReportInfo'},
                    {code:'InspectItemName',text:'检验项目',example:'检验项目：一般细菌培养及鉴定(仪器法),',type:'default',category:'PatientInfo'},
                    {code:'Barcode',text:'条形码号',example:'条形码号：2500001023',type:'default',category:'PatientInfo'},
                    {code:'InpatientAreaName',text:'病区',example:'病区：同三病区',type:'default',category:'PatientInfo'},
                    {code:'DepartmentName',text:'科室',example:'科室：SICU',type:'default',category:'PatientInfo'},
                    {code:'BedNo',text:'床位号',example:'床位号：4',type:'default',category:'PatientInfo'},
                    {code:'ChargeTypeName',text:'收费类型',example:'收费类型：新医保',type:'default',category:'PatientInfo'},
                    {code:'SpecimenTypeName',text:'标本类型',example:'标本类型：血',type:'default',category:'PatientInfo'},
                    {code:'PatientTypeName',text:'病人类型',example:'病人类型：住院',type:'default',category:'PatientInfo'},
                    {code:'Remark',text:'备注',example:'备注：请遵医嘱',type:'default',category:'ReportInfo'},
                    {code:'Comment',text:'评语',example:'评语:此报告仅对送检标本负责，结果供医生参考',type:'comment',category:'ReportInfo'},
                    {code:'ReportDeclaration',text:'报告声明',example:'此报告仅对送检标本负责，结果供医生参考',type:'normal',category:'ReportInfo'},
                    {code:'AntibioticResult',text:'细菌药敏结果',example:'细菌药敏结果',type:'mutipleline',category:'ReportInfo'},
                    {code:'IdentifyResult',text:'鉴定结果',example:'鉴定结果',type:'mutipleline',category:'ReportInfo'},
                    {code:'Line',text:'间隔线',example:'',type:'line',category:'Tool'},
                ],
                BacteriaControl:[
                    {code:'BacteriaName',text:'菌名称',example:'肺炎克雷伯菌',type:'normal',category:'BacteriaBarcode'},
                    {code:'BacteriaBarcode',text:'菌条形码',example:'510192703',type:'barcode',category:'BacteriaBarcode'},
                ],
                PreBarcodeControl:[
                    {code:'PatientName',text:'病人姓名',example:'贾三',type:'normal',category:'PresetBarcode'},
                    {code:'SpecimenType',text:'标本类型',example:'腹水',type:'normal',category:'PresetBarcode'},
                    {code:'PetriDishName',text:'培养基名称',example:'BAP',type:'normal',category:'PresetBarcode'},
                    {code:'PresetBarcode',text:'预置条码',example:'510192703',type:'barcode',category:'PresetBarcode'},
                ]
        }
        var Common = {
            getEvent: function() {//ie/ff
                if (document.all) {
                    return window.event;
                }
                func = getEvent.caller;
                while (func != null) {
                    var arg0 = func.arguments[0];
                    if (arg0) {
                        if ((arg0.constructor == Event || arg0.constructor == MouseEvent) || (typeof (arg0) == "object" && arg0.preventDefault && arg0.stopPropagation)) {
                            return arg0;
                        }
                    }
                    func = func.caller;
                }
                return null;
            },
            getMousePos: function(ev) {
                if (!ev) {
                    ev = this.getEvent();
                }
                if (ev.pageX || ev.pageY) {
                    return {
                        x: ev.pageX,
                        y: ev.pageY
                    };
                }
                if (document.documentElement && document.documentElement.scrollTop) {
                    return {
                        x: ev.clientX + document.documentElement.scrollLeft - document.documentElement.clientLeft,
                        y: ev.clientY + document.documentElement.scrollTop - document.documentElement.clientTop
                    };
                }
                else if (document.body) {
                    return {
                        x: ev.clientX + document.body.scrollLeft - document.body.clientLeft,
                        y: ev.clientY + document.body.scrollTop - document.body.clientTop
                    };
                }
            },            
            getItself: function(id) {
                return "string" == typeof id ? $("#"+id) : id;
            },
            getDataItem:function(value,valueFeild,data){
                var result=null;
                $.each(data,function(index, el) {
                    if(el[valueFeild]==value){
                       result=el;
                    }
                });
                return result;
            },
            getDataList:function(value,valueFeild,data){
                var result=[];
                $.each(data,function(index, el) {
                    if(el[valueFeild]==value){
                       result.push(el);
                    }
                });
                return result;
            },

            getDpi:function(){
                var arrDPI = new Array();
                if (window.screen.deviceXDPI != undefined) {
                    arrDPI[0] = window.screen.deviceXDPI;
                    arrDPI[1] = window.screen.deviceYDPI;
                }
                else {
                    var tmpNode = document.createElement("DIV");
                    tmpNode.style.cssText = "width:1in;height:1in;position:absolute;left:0px;top:0px;z-index:99;visibility:hidden";
                    document.body.appendChild(tmpNode);
                    arrDPI[0] = parseInt(tmpNode.offsetWidth);
                    arrDPI[1] = parseInt(tmpNode.offsetHeight);
                    tmpNode.parentNode.removeChild(tmpNode);    
                }
                return arrDPI;
            },
            getViewportSize: { w: (window.innerWidth) ? window.innerWidth : (document.documentElement && document.documentElement.clientWidth) ? document.documentElement.clientWidth : document.body.offsetWidth, h: (window.innerHeight) ? window.innerHeight : (document.documentElement && document.documentElement.clientHeight) ? document.documentElement.clientHeight : document.body.offsetHeight },
            isIE: document.all ? true : false,
        }
        var DPIX,DPIY;

        var Canvas={
            changePaper:function(key){
                var paper=PaperType[key];
                this.height(paper.height*DPIY).width(paper.width*DPIX);
            },
            area:function(){
                var _this=this;
                return{
                    left:_this.offset().left,
                    top:_this.offset().top,
                    right:_this.offset().left+_this.outerWidth(),
                    bottom:_this.offset().top+_this.outerHeight(),
                    width:_this.outerWidth(),
                    height:_this.outerHeight()
                }
            }
        }
        var Class = {
            create: function() {
                return function() { this.init.apply(this, arguments); }
            }
        }
        var Drag = Class.create();
        Drag.prototype = {
            init: function(id,canvasId,controlList,options) {
                var $dragDiv=Common.getItself(id);
                var canvasArea=Canvas.area.call(Common.getItself(canvasId));
                this.dragArea = { maxLeft: -canvasArea.left, maxRight: Common.getViewportSize.w - $dragDiv.width() - 2, maxTop: 0, maxBottom: Common.getViewportSize.h - $dragDiv.height() - 2 };
                if (options) {
                    this.keepOrigin = options.keepOrigin ? ((options.keepOrigin == true || options.keepOrigin == false) ? options.keepOrigin : false) : false;
                    this.autoDistance=isNaN(parseInt(options.autoDistance))?6:options.autoDistance;
                    if (this.keepOrigin) { this.opacity = 0.5; }
                    if (options.area) {
                        if (options.area.left && !isNaN(parseInt(options.area.left))) { this.dragArea.maxLeft = options.area.left };
                        if (options.area.right && !isNaN(parseInt(options.area.right))) { this.dragArea.maxRight = options.area.right };
                        if (options.area.top && !isNaN(parseInt(options.area.top))) { this.dragArea.maxTop = options.area.top };
                        if (options.area.bottom && !isNaN(parseInt(options.area.bottom))) { this.dragArea.maxBottom = options.area.bottom };
                    }
                }
                else {
                    this.opacity = 100, this.keepOrigin = false;this.autoDistance=6;
                }
                this.tmpX = 0;
                this.tmpY = 0;
                this.moveable = false;
                this.currentDrag=$dragDiv;

                var dragObj = this;
                dragObj.currentDrag.mousedown(function(e) {
                    var ev = e || window.event || Common.getEvent();
                    //只允许通过鼠标左键进行拖拽,IE鼠标左键为1 FireFox为0
                    if (Common.isIE && ev.button == 1 || !Common.isIE && ev.button == 0) {
                    }
                    else {
                        return false;
                    }
                    var dragDivArea=Canvas.area.call($dragDiv);
                    if (dragObj.keepOrigin) {
                        var newId = (new Date()).getTime() + parseInt(Math.random() * 100000);
                        newId=id+'-'+newId;
                        dragObj.currentDrag = dragObj.getControlDom(id,canvasArea,controlList);
                        dragObj.currentDrag.attr({id:newId,control:id})
                                             .css({position:'absolute','z-index':(dragObj.getZindex()+1),top:dragDivArea.top-canvasArea.top,left:dragDivArea.left-canvasArea.left})
                                             .appendTo("#"+canvasId)
                        new Drag(newId,canvasId,{keepOrigin: false,autoDistance:dragObj.autoDistance});
                    }
                    dragObj.currentDrag.css("opacity",0.6);
                    dragObj.moveable = true;
                    var downPos = Common.getMousePos(ev);
                    dragObj.tmpX = downPos.x - dragDivArea.left;
                    dragObj.tmpY = downPos.y - dragDivArea.top;
                    dragObj.currentDrag.css("cursor","move");
                    if (Common.isIE) {
                        dragObj.currentDrag.setCapture();
                    } else {
                        window.captureEvents(Event.mousemove);
                    }
                    //FireFox 去除容器内拖拽图片问题
                    if (ev.preventDefault) {
                        ev.preventDefault();
                        ev.stopPropagation();
                    }
                    document.onmousemove = function(e) {
                        if (dragObj.moveable) {
                            var ev = e || window.event || Common.getEvent();
                            //IE 去除容器内拖拽图片问题
                            if (document.all) //IE
                            {
                                ev.returnValue = false;
                            }
                            var currentX=0,currentY=0,movePos,campareDragTops=[],campareDragLefts=[];
                            movePos = Common.getMousePos(ev);
                            console.log(dragObj.dragArea)
                            currentX=Math.max(Math.min(movePos.x - dragObj.tmpX-canvasArea.left, dragObj.dragArea.maxRight), dragObj.dragArea.maxLeft);
                            currentY=Math.max(movePos.y - dragObj.tmpY-canvasArea.top, dragObj.dragArea.maxTop);
                            $(".child-drag").not(dragObj.currentDrag).each(function(index,item){
                                campareDragLefts.push($(this).position().left);
                                campareDragTops.push($(this).position().top);
                            });
                            var campareTop=campareDragTops.sort(function(a, b) {
                                  return Math.abs(a - currentY) - Math.abs(b - currentY);
                                })[0];
                            var campareLeft=campareDragLefts.sort(function(a, b) {
                                  return Math.abs(a - currentX) - Math.abs(b - currentX);
                                })[0];
                            if ((campareTop-dragObj.autoDistance)<currentY&&currentY<(campareTop+dragObj.autoDistance)) {
                                    $(".tips-line-y").remove();
                                    $("<div>").attr('class','tips-line-y')
                                              .css({top:campareTop,width:canvasArea.width+'px',})
                                              .appendTo('#'+canvasId);
                                    dragObj.currentDrag.css('top',+campareTop+"px");
                                }else{
                                    $(".tips-line-y").remove();
                                    dragObj.currentDrag.css('top',+currentY+"px");
                            }
                            if ((campareLeft-dragObj.autoDistance)<currentX&&currentX<(campareLeft+dragObj.autoDistance)) {
                                    $(".tips-line-x").remove();
                                    $("<div>").attr('class','tips-line-x')
                                              .css({left:campareLeft,height:canvasArea.height+'px',})
                                              .appendTo('#'+canvasId);
                                    dragObj.currentDrag.css('left',campareLeft+"px");
                                }else{
                                    $(".tips-line-x").remove();
                                    dragObj.currentDrag.css('left',currentX+"px");
                            }
                        }
                    };
                    document.onmouseup = function() {
                        if (dragObj.moveable) {
                            if (Common.isIE) {
                                dragObj.currentDrag.releaseCapture();
                            }
                            else {
                                window.releaseEvents(dragObj.currentDrag.mousemove);
                            }
                            $(".tips-line-x,.tips-line-y").remove();
                            dragObj.currentDrag.css({opacity:1,cursor:'default'})
                            dragObj.moveable = false;
                            dragObj.tmpX = 0;
                            dragObj.tmpY = 0;
                            dragDivArea= Canvas.area.call(dragObj.currentDrag);
                            if (dragDivArea.right<canvasArea.left||dragDivArea.bottom<canvasArea.top||dragDivArea.left>canvasArea.right||dragDivArea.top>canvasArea.bottom) {
                                dragObj.currentDrag.remove();
                            }
                        }
                    };
                }); 

            },
            getZindex: function() {
                var maxZindex = 0;
                var divs = document.getElementsByTagName(".child-drag");
                if (divs.length==0||divs==undefined) {return 1;}
                for (z = 0; z < divs.length; z++) {
                    maxZindex = Math.max(maxZindex, divs[z].style.zIndex);
                }
                return maxZindex;
            },
            getControlDom:function(type,canvasArea,controlList){
              var control=Common.getDataItem(type,'code',controlList);
                switch(control.type)
                {
                    case 'default':
                    return $("<div>").attr({class:'child-drag'}).html(control.example);
                    case 'title':
                    return $("<div>").attr({class:'child-drag title'}).html(control.example);
                    case 'normal':
                    return $("<div>").attr({class:'child-drag normal'}).html(control.example);
                    case 'line':
                    return $("<div>").attr({class:'child-drag line'}).width(canvasArea.width-100).height(3).html(control.example);
                    case 'mutipleline':
                    return $("<div>").attr({class:'child-drag mutipleline'}).width(canvasArea.width-100).html('<div>'+control.example+'</div><div>'+control.example+'</div><div>'+control.example+'</div><div>'+control.example+'</div>');
                    case 'comment':
                    return $("<div>").attr({class:'child-drag mutipleline'}).width(canvasArea.width-100).html('<div>'+control.example+'</div>');
                    case 'barcode':
                    return $("<div>").attr({class:'child-drag barcode'}).html('<div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div Class="code-num">'+control.example+'</div>');
                    default:
                    return $("<div>").attr({class:'child-drag'}).html(control.example);
                }
            }

        }

        var PaperPrint={
            init:function(printModel,opts){
                //表格行高：LineHeight  控件宽度缩放倍数：ScareTimes  纸张宽度：PaperWidth 纸张高度：PaperHeight
                if (opts) {
                    this.LineHeight=isNaN(opts.LineHeight)?5:opts.LineHeight;
                    this.ScareTimes=isNaN(opts.ScareTimes)?1.5:opts.ScareTimes;
                    this.Title=opts.Title?opts.Title:'微生物报告打印';
                    this.FontSize=isNaN(opts.FontSize)?11:opts.FontSize;
                    this.CodeType=opts.CodeType?opts.CodeType:'128B';
                }else{
                    this.LineHeight=5;
                    this.ScareTimes=1.5;
                    this.Title='微生物报告打印';
                    this.FontSize=11;
                    this.CodeType='128B';
                }
                this.PaperWidth=printModel.PaperInfo.size.width==null||undefined?210:printModel.PaperInfo.size.width;
                this.PaperHeight=printModel.PaperInfo.size.height==null||undefined?210:printModel.PaperInfo.size.height;
                this.PaperType=printModel.PaperInfo.type==null||undefined?'A4':printModel.PaperInfo.type;
                LODOP.PRINT_INIT(this.Title);
                LODOP.SET_PRINT_PAGESIZE(0, this.PaperWidth+'mm', this.PaperHeight+'mm',this.PaperType);
                LODOP.SET_PRINT_STYLE("FontSize",this.FontSize);
                var antibioticModel=Common.getDataItem('AntibioticResult','type',printModel.ControlList);
                if (antibioticModel) {
                  var increase=(Math.ceil(Report.ReportRAntibioticResult.length/2)+5)*this.LineHeight-antibioticModel.height;
                  printModel.ControlList=this.partData(antibioticModel.topNum,'topNum',printModel.ControlList,increase);
                }
                switch(printModel.PrintType){
                    case 'ReportControl':this.reportPrint(printModel);break;
                    case 'BacteriaControl':this.bacteriaPrint(printModel);break;
                    case 'PreBarcodeControl':this.preBarcodePrint(printModel);break;
                    default:this.reportPrint(printModel);break;
                }
            },
            prieview:function(printModel,opts){
                this.init(printModel,opts);
                LODOP.PREVIEW();
            },
            print:function(printModel,opts){
                this.init(printModel,opts);
                LODOP.PRINT();
            },
            bacteriaPrint:function(printModel){
                $.each(printModel.ControlList,function(index, el) {
                    switch(el.type){
                        case 'BacteriaBarcode':
                        LODOP.ADD_PRINT_BARCODE(el.top,el.left,el.width+'mm',el.height+'mm',this.CodeType,el.example);break;
                        default:LODOP.ADD_PRINT_TEXT(el.top,el.left,el.width+'mm',el.height+'mm',el.example);break;
                    }
                }.bind(this));
            },
            preBarcodePrint:function(printModel){
                $.each(printModel.ControlList,function(index, el) {
                    switch(el.type){
                        case 'PresetBarcode':LODOP.ADD_PRINT_BARCODE(el.top,el.left,el.width+'mm',el.height+'mm',this.CodeType,el.example);break;
                        default:LODOP.ADD_PRINT_TEXT(el.top,el.left,el.width+'mm',el.height+'mm',el.example);break;
                    }
                }.bind(this));
            },
            reportPrint:function(printModel){
                var printObj=this;
                $.each(printModel.ControlList,function(index, el) {
                    switch(el.type){
                        case 'SampleNo':LODOP.ADD_PRINT_TEXT(el.top,el.left,el.width*printObj.ScareTimes+'mm',el.height,el.text+":"+Report[el.type]);break;
                        case 'Line':LODOP.ADD_PRINT_LINE(el.top,'10mm',el.top,(printObj.PaperWidth-20)+'mm',0,1);break;
                        case 'Hospital':LODOP.ADD_PRINT_TEXT(el.top,el.left,el.width*printObj.ScareTimes+'mm',el.height,el.example);break;
                        case 'ReportDeclaration':LODOP.ADD_PRINT_TEXT(el.top,el.left,el.width*printObj.ScareTimes+'mm',el.height,el.example);break;
                        case 'IdentifyResult':
                           var len=Report.ReportRIdentifyResult.length;
                           var titleTop=el.topNum+printObj.LineHeight;
                           if (len==0) {
                                    return;
                            }else if(len==1){
                                LODOP.ADD_PRINT_TEXT(el.top,el.left,el.width*printObj.ScareTimes+'mm',el.height,'鉴定结果：');
                                LODOP.ADD_PRINT_TEXT(titleTop+"mm",(printObj.PaperWidth)/8+"mm",el.width+'mm',el.height,'鉴定结果/细菌描述');
                                LODOP.ADD_PRINT_TEXT(titleTop+"mm",printObj.PaperWidth/2+'mm',el.width+'mm',el.height,'细菌描述');
                                LODOP.ADD_PRINT_TEXT((el.topNum+printObj.LineHeight*2)+"mm",printObj.PaperWidth/8+'mm',el.width+'mm',el.height,Report.ReportRIdentifyResult[0].BacteriaName);
                                LODOP.ADD_PRINT_TEXT((el.topNum+printObj.LineHeight*2)+"mm",printObj.PaperWidth/2+'mm',el.width+'mm',el.height,Report.ReportRIdentifyResult[0].TestValue);
                            }else{
                                var left1,left2,titleTop;
                                left1=el.leftNum+12;left2=printObj.PaperWidth*5/16;
                                LODOP.ADD_PRINT_TEXT(el.top,el.left,el.width*printObj.ScareTimes+'mm',el.height,'鉴定结果：');
                                LODOP.ADD_PRINT_TEXT(titleTop+"mm",left1+"mm",el.width+'mm',el.height,'鉴定结果/细菌描述');
                                LODOP.ADD_PRINT_TEXT(titleTop+"mm",left2+'mm',el.width+'mm',el.height,'细菌描述');
                                LODOP.ADD_PRINT_LINE(titleTop+"mm",(printObj.PaperWidth/2-1)+"mm",el.topNum+(Math.ceil(Report.ReportRIdentifyResult.length/2)+1)*printObj.LineHeight+'mm',(printObj.PaperWidth/2-1)+"mm",0,1);
                                LODOP.ADD_PRINT_TEXT(titleTop+"mm",left1+(printObj.PaperWidth)/2+"mm",el.width+'mm',el.height,'鉴定结果/细菌描述');
                                LODOP.ADD_PRINT_TEXT(titleTop+"mm",left2+printObj.PaperWidth/2+'mm',el.width+'mm',el.height,'细菌描述');
                                $.each(Report.ReportRIdentifyResult,function(i, idtfyResult) {
                                    if (i%2==0) {
                                        left1=el.leftNum+12;left2=printObj.PaperWidth*5/16;
                                    }else{
                                        left1=el.leftNum+12+printObj.PaperWidth/2;left2=printObj.PaperWidth*13/16;
                                    }
                                    var currentH=(el.topNum+printObj.LineHeight*(Math.floor(i/2)+2))+"mm";
                                    LODOP.ADD_PRINT_TEXT(currentH+"mm",left1+"mm",el.width+'mm',el.height,idtfyResult.BacteriaName);
                                    LODOP.ADD_PRINT_TEXT(currentH+"mm",left2+'mm',el.width+'mm',el.height,idtfyResult.TestValue);
                                });
                            }
                            break;
                        case 'AntibioticResult':
                            var mutipelHeight=0;
                            $.each(Report.ReportRIdentifyResult,function(i, bctr) {
                                var antibiotics= Common.getDataList(bctr.BacteriaSerial,'BacteriaSerial',Report.ReportRAntibioticResult);
                                if (antibiotics.length>0) {
                                    LODOP.ADD_PRINT_TEXT(el.top,el.left,(el.width*printObj.ScareTimes)+'mm',el.height,bctr.BacteriaName);
                                        var left1,left2,left3,titleTop;
                                        left1=el.leftNum;
                                        left2=el.leftNum+printObj.PaperWidth/4;
                                        left3=el.leftNum+printObj.PaperWidth/8*3-7;
                                        titleTop=el.topNum+printObj.LineHeight+mutipelHeight;
                                        LODOP.ADD_PRINT_TEXT(titleTop+"mm",left1+'mm',el.width+'mm',el.height,'药敏');
                                        LODOP.ADD_PRINT_TEXT(titleTop+"mm",left2+'mm',el.width+'mm',el.height,'抑菌浓度');
                                        LODOP.ADD_PRINT_TEXT(titleTop+"mm",left3+'mm',el.width+'mm',el.height,'结果');
                                        LODOP.ADD_PRINT_LINE(titleTop+"mm",(printObj.PaperWidth/2-5)+"mm",titleTop+(Math.ceil(antibiotics.length/2)+1)*printObj.LineHeight+'mm',(printObj.PaperWidth/2-5)+"mm",0,1);

                                        LODOP.ADD_PRINT_TEXT(titleTop+"mm",left1+printObj.PaperWidth/2-4+'mm',el.width+'mm',el.height,'药敏');
                                        LODOP.ADD_PRINT_TEXT(titleTop+"mm",left2+printObj.PaperWidth/2-el.leftNum+'mm',el.width+'mm',el.height,'抑菌浓度');
                                        LODOP.ADD_PRINT_TEXT(titleTop+"mm",left3+printObj.PaperWidth/2-el.leftNum+'mm',el.width+'mm',el.height,'结果');
                                        $.each(antibiotics,function(j, antbotc) {
                                        var currentH=(el.topNum+printObj.LineHeight*(Math.floor(j/2)+2)+mutipelHeight)+"mm";
                                        if (j%2==0) {
                                            left1=el.leftNum;left2=el.leftNum+printObj.PaperWidth/4;left3=el.leftNum+printObj.PaperWidth/8*3-7;
                                            }else{
                                            left1=printObj.PaperWidth/2;
                                            left2=el.leftNum+printObj.PaperWidth/4*3-el.leftNum;
                                            left3=el.leftNum+printObj.PaperWidth/8*7-7-el.leftNum;
                                            }
                                        LODOP.ADD_PRINT_TEXT(currentH,left1+"mm",el.width+'mm',el.height,antbotc.AntibioticName+"("+antbotc.AntibioticCode+")");
                                        var micOrMid=antbotc.MIC==null||""?antbotc.MID:antbotc.MIC;
                                        LODOP.ADD_PRINT_TEXT(currentH,left2+'mm',el.width+'mm',el.height,micOrMid);
                                        LODOP.ADD_PRINT_TEXT(currentH,left3+'mm',el.width+'mm',el.height,antbotc.TestValue);
                                        });
                                    mutipelHeight+=(Math.ceil(antibiotics.length/2)+2)*printObj.LineHeight;
                                }
                            });
                            break;
                        default:LODOP.ADD_PRINT_TEXT(el.top,el.left,el.width*printObj.ScareTimes+'mm',el.height,el.text+":"+Report.ReportRPatient[el.type]);break;
                    }
                });
            },
            partData:function(value,valueFeild,data,increase){
                var result=[];
                $.each(data,function(index, el) {
                    if(el[valueFeild]>value){
                        el.topNum=el.topNum+increase;
                        el.top=el.topNum+'mm';
                        result.push(el);
                    }else{
                        result.push(el);
                    }
                });
                return result;
            },
        }
        var ControlGenerate={
            generate:function(data,containerId,canvasId) {
                var container=$("#"+containerId);
                container.empty();
                $.each(data,function(index, el) {
                    var elment=$("<div>").attr({class:'original-model',id:el.code}).html(el.text);
                    var category=$("#"+containerId).children('#'+el.category);
                    if (category!=undefined&&category.length>0) {
                        elment.appendTo(category[0]);
                    }else{
                        $('<h5>').attr('class','category-name').html(el.category).appendTo(container);
                        var category= $('<div>').attr('id',el.category).appendTo(container);
                        elment.appendTo(category);
                    }
                    new Drag(el.code,canvasId,data,{keepOrigin: true,autoDistance:6});
                });
            }
        }

        $(function(){
            var dpiArr=Common.getDpi();
            DPIX=dpiArr[0]/25.4;
            DPIY=dpiArr[1]/25.4;
            for (var key in PaperType) {
                $("<div>").attr({id:key,class:PaperType[key].isDefault?'nav-item e':'nav-item'}).html(key).appendTo('#PaperType');
                if (key=='Other') {
                    $("#PaperWidth").val(PaperType[key].width);
                    $("#PaperHeight").val(PaperType[key].height);

                }
            }

            $(".nav-item").live("click",function(){
                var _this=$(this);
                _this.addClass('e').siblings().removeClass('e');
                if (_this.attr('id')=="Other") {
                    $(".paper-container").show();
                }else{
                    $(".paper-container").hide();
                }
                Canvas.changePaper.call($("#Canvas"),_this.attr('id'));
                ControlGenerate.generate(ControlLibrary[$("#ModelType").val()],'ControlContainer','Canvas');
            });
            //自定义纸张大小
            $("#Confirm").live('click', function(event) {
                PaperType.Other.width=$("#PaperWidth").val();
                PaperType.Other.height=$("#PaperHeight").val();
                Canvas.changePaper.call($("#Canvas"),'Other');
                ControlGenerate.generate(ControlLibrary[$("#ModelType").val()],'ControlContainer','Canvas');
            });
            //初始化画布
            Canvas.changePaper.call($("#Canvas"),$(".nav-item.e").attr('id'));
            //初始化拖拽控件
            ControlGenerate.generate(ControlLibrary[$("#ModelType").val()],'ControlContainer','Canvas');

            $("#ModelType").change(function(event) {
                ControlGenerate.generate(ControlLibrary[$(this).val()],'ControlContainer','Canvas');
            });
            //生成模板
            $("#Print").live('click', function() {
                var Result={PaperInfo:{},ControlList:[]},canvasArea={},_papertype,_modelType;
                _papertype=$(".nav-item.e").attr('id');
                _modelType=$("#ModelType").val();
                Result.PaperInfo={type:_papertype,size:PaperType[_papertype]};
                Result.PrintType=_modelType;
                canvasArea=Canvas.area.call($("#Canvas"));
                $(".child-drag").each(function(index, el) {
                    var _this,type,area,item,_top,_left;
                    _this=$(this);
                    type=_this.attr('control');
                    item=Common.getDataItem(type,'code',ControlLibrary[_modelType]);
                    area=Canvas.area.call(_this);
                    _top=Math.round((area.top-canvasArea.top)/DPIY);
                    _left=Math.round((area.left-canvasArea.left)/DPIX);
                    Result.ControlList.push({
                        type:type,
                        top:_top+'mm',
                        left:_left+'mm',
                        topNum:_top,
                        leftNum:_left,
                        width:Math.round(area.width/DPIX),
                        height:Math.round(area.height/DPIY),
                        text:item.text,
                        example:item.example
                    });
                });
                console.log(Result.ControlList);

                //获取模板打印
                PaperPrint.prieview(Result,{LineHeight:5,FontSize:11});
            });
        });
